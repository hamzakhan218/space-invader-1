<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Invaders</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
            background-color: black;
            margin: 0 auto;
        }
    </style>
</head>

<body>
    <canvas id="gameCanvas" width="800" height="500"></canvas>
    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        // Player settings
        const playerWidth = 40;
        const playerHeight = 20;
        let playerX = canvas.width / 2 - playerWidth / 2;
        const playerY = canvas.height - 30;
        const playerSpeed = 5;

        // Bullet settings
        const bulletWidth = 4;
        const bulletHeight = 10;
        const bulletSpeed = 5;
        const bullets = [];

        // Enemy settings
        const enemyRows = 5;
        const enemyCols = 10;
        const enemyWidth = 40;
        const enemyHeight = 30;
        const enemySpacing = 20;
        const enemies = [];
        let enemySpeed = 1;
        let direction = 1;
        const enemyBullets = [];
        let enemyBulletSpeed = 3;
        let isPlayerInvincible = false;
        const invincibilityFrames = 60; // Number of frames for invincibility
        let invincibilityCountdown = 0;
        let isPlayerVisible = true;
        let playerAlpha = 1.0;

        // Scoring
        let score = 0;
        let playerLives = 3;
        let currentLevel = 1;
        const maxLevels = 2;

        // Event listener for Enter key press to restart the game
        document.addEventListener("keydown", restartGame);

        function restartGame(e) {
            if (e.key === "Enter") {
                document.removeEventListener("keydown", restartGame);
                resetGame();
                gameLoop();
                resetEnemyParameters();
            }
        }
        function resetEnemyParameters() {
            enemySpeed = 1; // Default enemy speed
            enemyBulletSpeed = 3; // Default enemy bullet speed
            // Add any other enemy parameters you want to reset
        }

        // Function to reset the game state
        function resetGame() {
            currentLevel = 1;
            playerLives = 3;
            enemySpeed = 1; // Default enemy speed
            enemyBulletSpeed = 3; 
            score = 0;
            createEnemies();
        }

        // Create the initial set of enemies
        function createEnemies() {
            enemies.length = 0; // Clear existing enemies

            for (let row = 0; row < enemyRows; row++) {
                for (let col = 0; col < enemyCols; col++) {
                    const x = col * (enemyWidth + enemySpacing);
                    const y = row * (enemyHeight + enemySpacing);
                    enemies.push({ x, y, alive: true });
                }
            }

            // Customize enemies based on the current level
            if (currentLevel === 2) {
                enemySpeed = 0.5; // Increase speed for level 2
                // Add spider enemies or any other adjustments for level 2
            }
        }

        createEnemies();

        // Draw the player
        function drawPlayer() {
            if (!isPlayerInvincible || (isPlayerInvincible && playerAlpha > 0.5)) {
                ctx.globalAlpha = playerAlpha;
                ctx.fillStyle = "green";
                ctx.fillRect(playerX, playerY, playerWidth, playerHeight);
                ctx.globalAlpha = 1.0; // Reset globalAlpha to default
                ctx.fillStyle = "red";
                ctx.font = "24px Arial";
                let hearts = "‚ù§ ".repeat(playerLives);
                ctx.fillText(hearts, canvas.width - 120, canvas.height - 20);

                ctx.fillStyle = "white";
                ctx.font = "24px Arial";
                ctx.fillText("Score: " + score, 20, canvas.height - 20);
            }

            // Update playerAlpha for blinking effect
            if (isPlayerInvincible) {
                playerAlpha -= 0.05; // Adjust the value to control the speed of blinking
                if (playerAlpha <= 0) {
                    playerAlpha = 1.0;
                }
            }
        }

        // Draw a bullet
        function drawBullet(bullet) {
            ctx.fillStyle = "white";
            ctx.fillRect(bullet.x, bullet.y, bulletWidth, bulletHeight);
        }

        // Draw all the enemies with a classic pixel-art style

        // Draw all the enemies with different appearances for Level 1 and Level 2
        // Draw all the enemies with different appearances for Level 1 and Level 2
        function drawEnemies() {
            const enemyColors = ["#00FFFF", "#00FFFF", "#FFD700", "#FFD700", "#FF0000"];
            enemies.forEach((enemy, index) => {
                if (enemy.alive) {
                    ctx.fillStyle = enemyColors[Math.floor(Math.random() * enemyColors.length)];

                    if (currentLevel === 1) {
                        // Draw Level 1 enemy appearance  
                        ctx.fillStyle = enemyColors[Math.floor(Math.random() * enemyColors.length)];
                        ctx.fillRect(enemy.x, enemy.y, enemyWidth, enemyHeight);
                        ctx.fillStyle = "black";
                        ctx.fillRect(enemy.x + 10, enemy.y + 10, 20, 5);
                        ctx.fillRect(enemy.x + 5, enemy.y + 15, 30, 5);
                        ctx.fillRect(enemy.x, enemy.y + 20, 40, 5);
                        ctx.fillRect(enemy.x + 10, enemy.y + 25, 20, 5);
                    }

                    if (currentLevel === 2) {
                        ctx.fillStyle = "black";
                        ctx.fillRect(enemy.x + 15, enemy.y + 10, 10, 10);
                        ctx.fillRect(enemy.x + 10, enemy.y + 20, 20, 10);
                        ctx.fillRect(enemy.x, enemy.y + 30, 40, 10);

                        // Draw pixelated spider legs
                        ctx.fillStyle = "#A52A2A"; // Brown color for legs
                        ctx.fillRect(enemy.x + 10, enemy.y, 2, 10);
                        ctx.fillRect(enemy.x + 20, enemy.y, 2, 10);
                        ctx.fillRect(enemy.x + 30, enemy.y, 2, 10);
                        ctx.fillRect(enemy.x + 5, enemy.y + 10, 2, 10);
                        ctx.fillRect(enemy.x + 35, enemy.y + 10, 2, 10);
                        ctx.fillRect(enemy.x + 10, enemy.y + 20, 2, 10);
                        ctx.fillRect(enemy.x + 30, enemy.y + 20, 2, 10);
                        ctx.fillRect(enemy.x + 15, enemy.y + 30, 2, 10);
                        ctx.fillRect(enemy.x + 25, enemy.y + 30, 2, 10);
                    }
                }
            });
        }



        // Move the player
        function movePlayer() {
            if (!isPlayerInvincible) {
                if (keys.ArrowLeft && playerX > 0) {
                    playerX -= playerSpeed;
                }
                if (keys.ArrowRight && playerX + playerWidth < canvas.width) {
                    playerX += playerSpeed;
                }
            }
        }

        // Move the bullets
        function moveBullets() {
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                bullet.y -= bulletSpeed;
                if (bullet.y < 0) {
                    bullets.splice(i, 1);
                }
            }
        }

        // Move the enemies
        function moveEnemies() {
            let moveDown = false;

            for (const enemy of enemies) {
                if (enemy.alive) {
                    enemy.x += enemySpeed * direction;

                    // Check if enemies hit the walls
                    if (enemy.x + enemyWidth > canvas.width || enemy.x < 0) {
                        moveDown = true;
                    }
                    if (Math.random() < 0.0005) {
                        generateEnemyBullet(enemy);
                    }
                }
            }

            // If any enemy hits the wall, move all enemies down
            if (moveDown) {
                direction *= -1;
                enemies.forEach((enemy) => {
                    if (enemy.alive) {
                        enemy.y += enemyHeight / 2;
                    }
                });
            }
        }

        // Collision detection
        function generateEnemyBullet(enemy) {
            const bulletX = enemy.x + enemyWidth / 2 - bulletWidth / 2;
            const bulletY = enemy.y + enemyHeight;
            enemyBullets.push({ x: bulletX, y: bulletY });
        }

        // ... (Previous code)

        function moveEnemyBullets() {
            for (let i = enemyBullets.length - 1; i >= 0; i--) {
                const bullet = enemyBullets[i];
                bullet.y += enemyBulletSpeed;

                // Remove bullets that go beyond the canvas
                if (bullet.y > canvas.height) {
                    enemyBullets.splice(i, 1);
                }
            }
        }

        function gameOver() {
            ctx.fillStyle = "white";
            ctx.font = "48px Arial";
            ctx.fillText("Game Over", canvas.width / 2 - 120, canvas.height / 2);
            // Ask the player to press Enter to start again
            document.addEventListener("keydown", restartGame);
        }

        // Collision detection
        function collisionDetection() {
            for (let i = bullets.length - 1; i >= 0; i--) {
                for (let j = enemies.length - 1; j >= 0; j--) {
                    const bullet = bullets[i];
                    const enemy = enemies[j];

                    if (enemy.alive) {
                        if (
                            bullet.x + bulletWidth > enemy.x &&
                            bullet.x < enemy.x + enemyWidth &&
                            bullet.y < enemy.y + enemyHeight &&
                            bullet.y + bulletHeight > enemy.y
                        ) {
                            bullets.splice(i, 1);
                            enemy.alive = false;
                            score += 10;
                            // Break out of the inner loop after a collision
                            break;
                        }
                    }
                }
            }

            for (let i = enemyBullets.length - 1; i >= 0; i--) {
                const enemyBullet = enemyBullets[i];

                if (!isPlayerInvincible &&
                    enemyBullet.x + bulletWidth > playerX &&
                    enemyBullet.x < playerX + playerWidth &&
                    enemyBullet.y < playerY + playerHeight &&
                    enemyBullet.y + bulletHeight > playerY
                ) {
                    enemyBullets.splice(i, 1);
                    playerLives--;
                    if (playerLives > 0) {
                        // Player respawns
                        playerX = canvas.width / 2 - playerWidth / 2;
                        isPlayerInvincible = true;
                        invincibilityCountdown = invincibilityFrames;
                    } else {
                        // Player has no lives left
                        gameOver();
                    }
                }
            }

            if (isPlayerInvincible) {
                invincibilityCountdown--;
                if (invincibilityCountdown <= 0) {
                    playerAlpha = 1.0;
                    isPlayerInvincible = false;
                }
            }
        }

        // Handle keyboard input
        const keys = {};
        window.addEventListener("keydown", (e) => {
            keys[e.code] = true;

            if (e.code === "Space" && bullets.length < 3) {
                playerX = playerX < 0 ? 0 : playerX;
                playerX = playerX > canvas.width - playerWidth ? canvas.width - playerWidth : playerX;
                const bulletX = playerX + playerWidth / 2 - bulletWidth / 2;
                const bulletY = playerY;
                bullets.push({ x: bulletX, y: bulletY });
            }
        });

        window.addEventListener("keyup", (e) => {
            keys[e.code] = false;
        });

        // Main game loop
        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            movePlayer();
            moveBullets();
            moveEnemies();
            collisionDetection();
            moveEnemyBullets();
            drawPlayer();
            bullets.forEach(drawBullet);
            drawEnemies();
            enemyBullets.forEach(drawBullet);

            // Draw score
            ctx.fillStyle = "white";
            ctx.font = "24px Arial";
            ctx.fillText("Score: " + score, 20, canvas.height - 20);

            // Check if the player has won Level 1
            if (currentLevel === 1 && enemies.every((enemy) => !enemy.alive)) {
                ctx.fillStyle = "green";
                ctx.font = "48px Arial";
                ctx.fillText("Level 1 Complete!", canvas.width / 2 - 160, canvas.height / 2 - 50);
                ctx.fillText("Press Enter for Level 2", canvas.width / 2 - 160, canvas.height / 2);
                document.addEventListener("keydown", startLevel2);
            }

            // Check if the player has won Level 2
            if (currentLevel === 2 && enemies.every((enemy) => !enemy.alive)) {
                ctx.fillStyle = "white";
                ctx.font = "48px Arial";
                ctx.fillText("You Win!", canvas.width / 2 - 100, canvas.height / 2);
                // Ask the player to press Enter to start again
                resetEnemyParameters();
                document.addEventListener("keydown", restartGame);
                if (currentLevel === maxLevels) {
                    resetEnemyParameters();
                }
            }

            // Check if the player has lost
            if (enemies.some((enemy) => enemy.y + enemyHeight >= playerY)) {
                resetEnemyParameters();
                gameOver();
            } else if (playerLives === 0) {
                resetEnemyParameters();
                gameOver();
            } else {
                requestAnimationFrame(gameLoop);
            }
        }

        // Function to start Level 2
        function startLevel2(e) {
            if (e.key === "Enter") {
                document.removeEventListener("keydown", startLevel2);
                resetGame();
                currentLevel = 2;
                enemySpeed = 0.5;
                createEnemies();
                gameLoop();
            }
        }

        gameLoop();
    </script>
</body>

</html>